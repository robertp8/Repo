<!DOCTYPE html>
<!--Google maps idKey: AIzaSyBDeKh4FF-2J1pT6C82m6XlgdTDmd7AjGk-->
<html>
<head>
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
	<meta charset="UTF-8">
	<title>Home</title>
	<link href="css/stylesheet.css" rel="stylesheet" type="text/css" media="screen">
	<link rel="stylesheet" href="//code.jquery.com/ui/1.11.2/themes/smoothness/jquery-ui.css">
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<script src="http://maps.googleapis.com/maps/api/js?v=3.exp&libraries=places&=geometry&sensor=false&key=AIzaSyBDeKh4FF-2J1pT6C82m6XlgdTDmd7AjGk"></script>
	<script src="//code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
	<script type="text/javascript" src="http://geoxml3.googlecode.com/svn/branches/polys/geoxml3.js"></script>
	<script type="text/javascript" src="http://geoxml3.googlecode.com/svn/trunk/ProjectedOverlay.js"></script>
	<script type="text/javascript" src="js/v3_epoly.js"></script>
</head>

<!--<body onload="getLocation()">-->
<body>

	<div id="masthead">
		<h1>Malama Natural Disaster Awareness</h1>
	</div>

	<div id="sidebarContent">
		<div id="sidebar">
			
			<div id="closeSidebar">X</div>
				<ul>
					<li>Hazards</li>
					<ul>
						<li><input type="radio" name="hazard" value="Tsunami" id="tsunami">Tsunami</input></li>
						<li><input type="radio" name="hazard" value="LavaFlow" id="lavaflow">Lava Flow</input></li>
						<li><input type="radio" name="hazard" value="Hurricane" id="hurricane">Hurricane</input></li>
						<li><input type="radio" name="hazard" value="Vog" id="vog">Vog</input></li>
					</ul>
				</ul>
				<!--<input type="button" value="View Map" id="select">-->
		</div>

		<div id="content">	
			
			<div id="sideBarBtn">more info</div>
			<h2>Please Enter A Physical Adress</h2>
			
			<center>
				<div id="map-canvas"></div>
				<input 	id="pac-input" class="controls" type="text" placeholder="Physical Address"></input>
				<div id="Dialog" title="Hazard Data">
					<p>Coordinates: <output id="txtOutput" type="text" placeholder="Location"></output></p>
					<p>Tsunami Zone: <output id="tsunamiZone" type="text" placeholder="WithinEvacZone"></output></p>
					<p>Lava Zone: <output id="lavaZone" type="text" placeholder="WithinEvacZone"></output></p>
				</div>
				<p id="message"></p>
			</center>
		</div>
	</div>
		
	<div id="footer">
		<p>IDK</p>
	</div>
	<script>
		$(document).ready(function(){
		
			$("#sidebar").hide();
			
			$("#closeSidebar").click(function(){
				$("#sidebar").hide();
				$("#content").css("width", "100%");
				$("#sideBarBtn").show();
			});
			
			$("#sideBarBtn").click(function(){
				$(this).hide();
				$("#content").css("width", "85%");
				$("#sidebar").show();
			});
		});
		
		//Shows current location
		/*var x = document.getElementByID("message");

		function getLocation() {
		
			if (navigator.geolocation) {
				navigator.geolocation.getCurrentPosition(showPosition);
			} else { 
				x.innerHTML = "Geolocation is not supported by this browser.";
			}
		}*/

		function initialize(){
			var markers = [];
			//Lat/Long for Hawaii coordinates
			var lat = (19.542915); 
			var lon = (-155.665857);
			var grabLoc = null;
			
			//Load map to Hawaii coordinates
			var hawaii = new google.maps.LatLng(lat, lon);
			var mapProp = {
				center: hawaii,
				zoom: 8,
				mapTypeId: google.maps.MapTypeId.ROADMAP
			};
		
			var map = new google.maps.Map(document.getElementById('map-canvas'), mapProp);
			
			
			
			//Search bar and coordinates
			var input = /** @type {HTMLInputElement} */(document.getElementById('pac-input'));
			map.controls[google.maps.ControlPosition.TOP_CENTER].push(input);
		  
			var searchBox = new google.maps.places.SearchBox(
			/** @type {HTMLInputElement} */(input));
			
			// [START region_getplaces]
			// Listen for the event fired when the user selects an item from the
			// pick list. Retrieve the matching places for that item.
			google.maps.event.addListener(searchBox, 'places_changed', function() {
				var places = searchBox.getPlaces();

				if (places.length == 0) {
					return;
				}
				for (var i = 0, marker; marker = markers[i]; i++) {
					marker.setMap(null);
				}

				// For each place, get the icon, place name, and location, output location
				markers = [];
				var txtOutput = document.getElementById("txtOutput");
				var bounds = new google.maps.LatLngBounds();
				for (var i = 0, place; place = places[i]; i++) {
					var image = {
						url: place.icon,
						size: new google.maps.Size(71, 71),
						origin: new google.maps.Point(0, 0),
						anchor: new google.maps.Point(17, 34),
						scaledSize: new google.maps.Size(25, 25)
					};

					// Create a marker for each place.
					var marker = new google.maps.Marker({
						map: map,
						icon: image,
						title: place.name,
						position: place.geometry.location
					});
		   
					markers.push(marker);
					bounds.extend(place.geometry.location);
				}
				map.fitBounds(bounds);
				
				//Displays Coordinates (lat, long)
				var grabLoc = marker.position;
				txtOutput.value = grabLoc;
				
				//Kml Parser that enables to render kml polygons as Google map api objects
				var geoXml = new geoXML3.parser({
					map: map,
					singleInfoWindow: true,
					afterParse: useTheData
				});
	
				//Allows to parse files and render them from local files
				geoXml.parse(['datafiles/tsunami_evac_zones.kml', 'datafiles/doc.kml']);
				
				//allows objects to be manipulated after parse renders objects
				function useTheData(doc) {
					// Geodata handling goes here, using JSON properties of the doc object
					//Number of polygons within Kml file
					var numPolys = doc[0].gpolygons.length;
					var numPolys2 = doc[1].gpolygons.length;
					
					
					// Loop through each polygon
					for(var i = 0; i < numPolys; i++){
						//hide all the polygons within kml file
						doc[0].gpolygons[i].setMap(null);
					};	
					
					for(var i = 0; i < numPolys2; i++){
						//hide all the polygons within kml file
						doc[1].gpolygons[i].setMap(null);
					};
					
					//Single out a certain polygon for visualization
					//doc[0].gpolygons[6].setMap(map);
					
					//Function contains "Contains" from v3_epoly.js file
					//Determines if a function is within a certain polygon
					if(doc[0].gpolygons[0].Contains(grabLoc)){
						tsunamiZone.value = '1';
					}else if(doc[0].gpolygons[1].Contains(grabLoc)){
						tsunamiZone.value = '1';
					}else if(doc[0].gpolygons[2].Contains(grabLoc)){
						tsunamiZone.value = '1';
					}else if(doc[0].gpolygons[3].Contains(grabLoc)){
						tsunamiZone.value = '1';
					}else if(doc[0].gpolygons[4].Contains(grabLoc)){
						tsunamiZone.value = '1';
					}else if(doc[0].gpolygons[5].Contains(grabLoc)){
						tsunamiZone.value = '1';
					}else if(doc[0].gpolygons[6].Contains(grabLoc)){
						tsunamiZone.value = '1';
					}else if(doc[0].gpolygons[7].Contains(grabLoc)){
						tsunamiZone.value = '1';
					}else if(doc[0].gpolygons[8].Contains(grabLoc)){
						tsunamiZone.value = '1';
					}else if(doc[0].gpolygons[9].Contains(grabLoc)){
						tsunamiZone.value = '1';
					}else if(doc[0].gpolygons[10].Contains(grabLoc)){
						tsunamiZone.value = '1';
					}else if(doc[0].gpolygons[11].Contains(grabLoc)){
						tsunamiZone.value = '1';
					}else if(doc[0].gpolygons[12].Contains(grabLoc)){
						tsunamiZone.value = '1';
					}else if(doc[0].gpolygons[13].Contains(grabLoc)){
						tsunamiZone.value = '1';
					}else if(doc[0].gpolygons[14].Contains(grabLoc)){
						tsunamiZone.value = '1';
					}else if(doc[0].gpolygons[15].Contains(grabLoc)){
						tsunamiZone.value = '1';
					}else{
						tsunamiZone.value = '0';
					}
					
					if(doc[1].gpolygons[0].Contains(grabLoc)){
						lavaZone.value = doc[1].placemarks[0].name;
					}else if(doc[1].gpolygons[1].Contains(grabLoc)){
						lavaZone.value = doc[1].placemarks[1].name;
					}else if(doc[1].gpolygons[2].Contains(grabLoc)){
						lavaZone.value = doc[1].placemarks[2].name;
					}else if(doc[1].gpolygons[3].Contains(grabLoc)){
						lavaZone.value = doc[1].placemarks[3].name;
					}else if(doc[1].gpolygons[4].Contains(grabLoc)){
						lavaZone.value = doc[1].placemarks[4].name;
					}else if(doc[1].gpolygons[5].Contains(grabLoc)){
						lavaZone.value = doc[1].placemarks[5].name;
					}else if(doc[1].gpolygons[6].Contains(grabLoc)){
						lavaZone.value = doc[1].placemarks[6].name;
					}else if(doc[1].gpolygons[7].Contains(grabLoc)){
						lavaZone.value = doc[1].placemarks[7].name;
					}else if(doc[1].gpolygons[8].Contains(grabLoc)){
						lavaZone.value = doc[1].placemarks[8].name;
					}else if(doc[1].gpolygons[9].Contains(grabLoc)){
						lavaZone.value = doc[1].placemarks[9].name;
					}else if(doc[1].gpolygons[10].Contains(grabLoc)){
						lavaZone.value = doc[1].placemarks[10].name;
					}else if(doc[1].gpolygons[11].Contains(grabLoc)){
						lavaZone.value = doc[1].placemarks[11].name;
					}else if(doc[1].gpolygons[12].Contains(grabLoc)){
						lavaZone.value = doc[1].placemarks[12].name;
					}else if(doc[1].gpolygons[13].Contains(grabLoc)){
						lavaZone.value = doc[1].placemarks[13].name;
					}else if(doc[1].gpolygons[14].Contains(grabLoc)){
						lavaZone.value = doc[1].placemarks[14].name;
					}else if(doc[1].gpolygons[15].Contains(grabLoc)){
						lavaZone.value = doc[1].placemarks[15].name;
					}else {
						lavaZone.value = '0';
					}
					
					//Dialog box 
					$(function() {
						$( "#Dialog" ).dialog({
							//autoOpen: false,
							modal: true,
							width: 500
						});
					  });
					
					<!--evacuation zone polygon-->
					/*var zoneCoords1 = [
						//new google.maps.LatLng(doc[0].gpolygons[8].coords)
						
					];	
					
				
					var hawaiiZone1 = new google.maps.Polygon({
						paths: zoneCoords1
					});
		
					hawaiiZone1.setMap(map);*/
					<!--check if point is within the evacuation zone-->
					/*var locOutput = document.getElementById("locOutput");
					if (google.maps.geometry.poly.containsLocation(grabLoc, hawaiiZone1)){
						locOutput.value = '1';
					}else{
						locOutput.value = '0';
					}*/
		  
				};
			});

			
			// [END region_getplaces]
			// Bias the SearchBox results towards places that are within the bounds of the
			// current map's viewport.
			google.maps.event.addListener(map, 'bounds_changed', function() {
				var bounds = map.getBounds();
				searchBox.setBounds(bounds);
			});
			
			//Kml Parser that enables to render kml polygons as Google map api objects
			var geoXml = new geoXML3.parser({
				map: map,
				singleInfoWindow: true,
				afterParse: displayKml
			});

			//Allows to parse files and render them from local files
			geoXml.parse(['datafiles/tsunami_evac_zones.kml', 'datafiles/doc.kml']);
			
			//This function will display any of the kml polygons, 
			//depending on which type of hazard the user chooses.
			function displayKml(doc){
				var numberOfPolys = doc[0].gpolygons.length;
				var numberOfPolys2 = doc[1].gpolygons.length;
				var value = null;
				
				//console.log(numberOfPolys2);
				//console.log(doc[1].placemarks.length);
				
				//Initially nullify all maps for kml 1
				for(var i = 0; i < numberOfPolys; i++){
					doc[0].gpolygons[i].setMap(null);
				}
				
				//Initially nullify all maps for kml 2
				for(var i = 0; i < numberOfPolys2; i++){
					doc[1].gpolygons[i].setMap(null);
				}
				
				$("#tsunami").click(function(){
					for(var i = 0; i < numberOfPolys; i++){
						doc[0].gpolygons[i].setMap(map);
					}
					for(var i = 0; i < numberOfPolys2; i++){
						doc[1].gpolygons[i].setMap(null);
					}
				});	
				
				$("#hurricane").click(function(){
					for(var i = 0; i < numberOfPolys; i++){
						doc[0].gpolygons[i].setMap(null);
					}
					for(var i = 0; i < numberOfPolys2; i++){
						doc[1].gpolygons[i].setMap(null);
					}
				});
				
				$("#lavaflow").click(function(){
					for(var i = 0; i < numberOfPolys; i++){
						doc[0].gpolygons[i].setMap(null);
					}
					for(var i = 0; i < numberOfPolys2; i++){
						doc[1].gpolygons[i].setMap(map);
					}
				});
			}
			
			//KML Layers
			/*var tsunamiEvac = new google.maps.KmlLayer({
				url: 'http://oos.soest.hawaii.edu/pacioos/kml/zzz_obsolete/tsunami_evac_zones.kml'
				
			});
			
			var tsunamiOutline = new google.maps.KmlLayer({
				url: 'http://geocommons.com/overlays/3307.kml'
			});
			
			$("#tsunami").click(function(){
				tsunamiOutline.setMap(null);
				tsunamiEvac.setMap(map);
			});
			
			$("#hurricane").click(function(){
				tsunamiOutline.setMap(map);
				tsunamiEvac.setMap(null);
			});*/
			
			function showError(error) {
				switch(error.code) {
					case error.PERMISSION_DENIED:
						x.innerHTML = "User denied the request for Geolocation."
						break;
					case error.POSITION_UNAVAILABLE:
						x.innerHTML = "Location information is unavailable."
						break;
					case error.TIMEOUT:
						x.innerHTML = "The request to get user location timed out."
						break;
					case error.UNKNOWN_ERROR:
						x.innerHTML = "An unknown error occurred."
						break;
				}
			}
			
		}
		google.maps.event.addDomListener(window, 'load', initialize);
	</script>
	
</body>
</html>